# BioEncoder root dir

BioEncoder uses a single directory to store all output related to a project. The different functions and steps will create different sub-folders inside - i.e., `split_dataset` will create the _data_ folder, `train` will create _logs_, _runs_ and _weights_ folders, and `interactive_plots` will create _plots_. In the end your root directory will like like this:

```
bioencoder-root-dir/
    data
        <run-name>
            train
                class_1/
                    image_1.jpg
                    image_2.jpg
                    ...
                class_2/
                    image_1.jpg
                    image_2.jpg
                    ...
                ...
            val
                ...
    logs
        <run-name>
            first
                <run-name>_first.log
            second
                <run-name>_second.log
    plots
        <run-name>.html
    runs
        <run-name>
            first
                events.out.tfevents...machine-name.15832.0
            second
                events.out.tfevents...machine-name.15832.1
    weights
        <run-name>
            first
                epoch0
                epoch1
                ...
                swa
            second
                epoch0
                epoch1
                ...
                swa
```                 

# Global configuration


Run `configure` to set the bioencoder root dir and the run name. The _run name_ will be used to name all output generated by BioEncoder, i.e., plots, logs, etc. 
```python
import bioencoder

bioencoder.configure(root_dir=r"bioencoder_wd", run_name="v1")
```

You will get something like this:

```
BioEncoder config:
- root_dir: bioencoder
- root_dir_abs: D:\temp\bioencoder-test\bioencoder
- run_name: damselflies-example
Given your Python WD (D:\temp\bioencoder-test), the current BioEncoder run directory will be:
- D:\temp\bioencoder-test\bioencoder\damselflies-example
```

This will create a root folder inside your project, where all relevant bioencoder data, logs, etc. will be stored.

# Split dataset

Run `split_dataset` on your input folder to create the data folder containing training and validation images. Your input folder should have as many subdirectories as classes. The key is to make sure that all images belonging to the same class are stored in the same subdirectory. Also, you do not need to worry about image resolution at this stage. The images will be resized during training using the parameters defined within the `YAML` configuration files. If a single class contains an overwhelming percentage of images consider undersampling it using `max_ratio`. Use `random_seed` to reproduce the randomized selection. There are a few more options - use `help(split_dataset)` to read about them.

```python
bioencoder.split_dataset(image_dir=r"~/Downloads/damselflies-aligned-trai_val", max_ratio=6, random_seed=42)
```

You will get something like this:

```
(bioencoder) D:\temp\bioencoder-test>bioencoder_split_dataset --image-dir data_raw\damselflies_aligned_resized
Number of images per class prior to balancing: [1099, 481, 137, 2402]
Minimum number of images per class: 137
Number of images per class after balancing: [959, 481, 137, 959]
0.1
Number of images per class reserved for validation: 63
Processing class androchrome...
Warning: androchrome contains more than 959 images. Only 959 images will be used.
Processing class infuscans...
Processing class infuscans-obsoleta...
Processing class male...
Warning: male contains more than 959 images. Only 959 images will be used.
```




